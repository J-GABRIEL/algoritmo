#include "stdafx.h"
#include "conio.h"
#include <stdio.h>
#include <string>
#include <iostream>
#include <stdlib.h>
using namespace std;
struct instrumento{
	string nombre;
	int codigo;
	string descripcion;
	string marca;
	int cantidad;
	string lugar;
	char estado;
};
struct partituras{
   int codigo;
   string nom;
   string autor;
   char estado;
};
struct usuario{
string usuarios;
string contra;
};
void crearArchivo(char nomArch[])
{
	FILE *ptr;
	ptr= fopen(nomArch, "wb");
	fclose(ptr);
}
void solicitarDatos(instrumento &reg) 
{	
	
	cout<<endl<< "Introducir Nombre:";
	do{
		getline(cin,reg.nombre);
	}while(reg.nombre.length() == 0);
	cout<< "codigo:";
	cin>> reg.codigo;
	cout<<"descripcion:";	
	do{
		getline(cin, reg.descripcion);
	}while(reg.descripcion.length() == 0);
	cout<<"marca:";	
	do{
		getline(cin,reg.marca);
	}while(reg.marca.length() == 0);

	cout<<"cantidad:";
	cin>>reg.cantidad;

	cout<<"lugar:";	
	do{
		getline(cin, reg.lugar);
		}while(reg.lugar.length() == 0);
     system("cls");

}
void mostrarRegistro(instrumento &reg, int nroReg)
{
	cout<<endl<< nroReg<<".-"<< reg.nombre<< "         "<<reg.codigo<< "    "<< reg.descripcion<<"   "<<reg.marca<<"   "<<reg.cantidad<<"    "<<reg.lugar;
}
void adicionarRegistro()
{
	FILE *ptr;
	instrumento reg;
	solicitarDatos(reg);
	reg.estado='A';
	ptr= fopen("instrumento.dat", "ab"); 
	fwrite(&reg, sizeof(reg),1,ptr);
	fclose(ptr);
}
void listarArchivo()
{
	FILE *ptr;
	instrumento reg;
	int cont=0;
	ptr= fopen("instrumento.dat","rb");
	if(ptr == NULL)
	{
		cout<< "EL archivo no existe...";
	}
	else
	{
		cout<<endl<<"   ** LISTADO DE INSTRUMENTOS **";
		cout<<endl<<" n   Nombre      codigo      descripcion      marca    cantidad     lugar";
		cout<<endl<<"---------------------------------------------------------------------------";
		fread(&reg, sizeof(reg),1,ptr);
		while(!feof(ptr))
		{
			if(reg.estado=='A')
			{
				mostrarRegistro(reg,cont+1);
			}
			fread(&reg, sizeof(reg),1,ptr);
			cont++;
		}
		fclose(ptr);
	}
}
void menuistrumento()
{
	int opcion;
	
	do{
	cout<<"\t\t INVENTARIO DE INSTRUMENTOS DE ORQUESTA"<<endl;
	cout<<"\t 1.Crear archivo"<<endl;
	cout<<"\t 2.Adicionar instrumento"<<endl;
	cout<<"\t 3.Buscar instrumento"<<endl;
	cout<<"\t 4.mostrar lista de instrumento"<<endl;
	cout<<"\t 5.modificar instrumento"<<endl;
	cout<<"\t 6.Eliminar instrumento"<<endl;
	cout<<"\t 7.volver a menu"<<endl;
	cout<<"\t 0.Salir"<<endl;
	cout<<"\t opcion: ";
	cin>>opcion;
	system("cls");
	switch(opcion)
	{
	case 1:
		crearArchivo("instrumento.dat");
		cout<<"--EL ARCHIVO FUE CREADO--";

		break;
	case 2:
		cout<<"Ingrese datos";
		listarArchivo();
		adicionarRegistro();
		break;
	case 3:
		
		break;
	case 4:
		listarArchivo();
		break;
	case 5:
		break;
	case 6:
		break;
	case 0:
		cout<<"\t saliendo del programa";
		break;
	default:
		cout<<"\t opcion invalida";
		break;
	}
	}while(opcion!=0);

}
void datospartidura(partituras &dat) 
{	
	cout<<endl<< "Nombre:";
	do{
		getline(cin,dat.nom);
	}while(dat.nom.length() == 0);
	cout<< "codigo:";
	cin>> dat.codigo;
	cout<<"autor:";	
	do{
		getline(cin, dat.autor);
	}while(dat.autor.length() == 0);
}
void Registro(partituras &dat, int nroReg)
{
	cout<<endl<<nroReg<<"\t"<<dat.nom<<"\t"<<dat.codigo<<"\t   "<<dat.autor<<endl;
}
void adicionarpartiduras()
{
	FILE *ptr;
	partituras dat;
	datospartidura(dat);
	dat.estado='A';
	ptr= fopen("partidura.dat","ab");
	fwrite(&dat, sizeof(dat),1,ptr);
	fclose(ptr);
}
void listar()
{
	FILE *ptr;
	partituras dat;
	int cont=0;
	ptr= fopen("partidura.dat","rb");
	if(ptr == NULL)
	{
		cout<< "EL archivo no existe...";
	}
	else
	{
		cout<<endl<<"   ** LISTADO DE PARTITURAS **";
		cout<<endl<<" n    Nombre      codigo      autor";
		cout<<endl<<"---------------------------------";
		fread(&dat, sizeof(dat),1,ptr);
		while(!feof(ptr))
		{
			if(dat.estado=='A')
			{
				Registro(dat,cont+1);
			}
			fread(&dat, sizeof(dat),1,ptr);
			cont++;
		}
		fclose(ptr);
	}
}
void menupartiduras()
{
	int opcion,n;
	do{
	cout<<"\t\t PARTIDURAS"<<endl;
	cout<<"\t 1.Crear archivo"<<endl;
	cout<<"\t 2.Adicionar partidura"<<endl;
	cout<<"\t 3.Buscar partidura"<<endl;
	cout<<"\t 4.Mostrar listar de partiduras"<<endl;
	cout<<"\t 5.Modificar partidura"<<endl;
	cout<<"\t 6.Eliminar partidura"<<endl;
	cout<<"\t 7.volver a menu"<<endl;
	cout<<"\t 0.Salir"<<endl;
	cout<<"\t opcion:";
	cin>>opcion;
	system("cls");
	switch(opcion)
	{
	case 1:
		crearArchivo("partidura.dat");
		cout<<"--El archivo fue creado--"<<endl;
		system("pause");
		system("cls");
		break;
	case 2:
		cout<<"\t INGRESE DATOS :)";
		listar();
		adicionarpartiduras();
		break;
	case 3:
		break;
	case 4:
	    listar();
		system("pause");
		system("cls");
		break;
	case 5:
		break;
	case 6:
		break;
	case 7:
		break;
	case 0:
		cout<<"\t saliendo del programa";
		break;
	default:
		cout<<"\t opcion invalida";
		break;
	}
	}while(opcion!=0);
	getch();

}
void main()
{
	int opcion;
	do{
	cout<<"\t\t ****MENU*****"<<endl;
	cout<<"\t 1.INSTRUMENTO"<<endl;
	cout<<"\t 2.PARTIDURAS"<<endl;
	cout<<"\t 3.VOLVER ATRAS"<<endl;
	cout<<"\t 0.salir del programa"<<endl;
	cout<<"\t opcion:";
	cin>>opcion;
	system("cls");
	switch(opcion)
	{
	case 1:
		menuistrumento();
		break;
	case 2:
		menupartiduras();
		break;
	case 3:
		//menu usuario();
		break;
	case 0:
		cout<<"\t saliendo del programa";
		break;
	default:
		cout<<"\t opcion invalida";
		break;
	}
	}while(opcion!=0);
   getch();
}
